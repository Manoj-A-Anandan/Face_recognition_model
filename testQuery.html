<!DOCTYPE html>
<html>
<head>
    <title>Match Person</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        input, button { padding: 10px; margin: 10px 0; display: block; }
        #gallery img { width: 200px; margin: 10px; border-radius: 8px; }
        label { font-weight: bold; }
    </style>
</head>
<body>

<h2>Match a Person</h2>

<label for="event-prefix">Event Prefix:</label>
<input type="text" id="event-prefix" placeholder="e.g. event_1763444430/">

<label for="query-image">Select Query Image:</label>
<input type="file" id="query-image" accept="image/*">

<button onclick="matchPerson()">Match</button>

<h3>Results:</h3>
<div id="gallery"></div>

<script>
async function matchPerson() {
    const file = document.getElementById("query-image").files[0];
    const eventPrefix = document.getElementById("event-prefix").value.trim();

    if (!eventPrefix) return alert("Please enter the event prefix!");
    if (!file) return alert("Please upload a query image!");

    const form = new FormData();
    form.append("file", file);
    form.append("event_prefix", eventPrefix);
    form.append("threshold", 0.5); // optional, adjust if needed

    try {
        const res = await fetch("http://localhost:8000/match-against-event", {
            method: "POST",
            body: form
        });

        const data = await res.json();
        console.log(data);

        const gallery = document.getElementById("gallery");
        gallery.innerHTML = "";

        if (!data.matches || data.matches.length === 0) {
            gallery.innerHTML = "<p>No matches found.</p>";
            return;
        }

        data.matches.forEach(m => {
            const img = document.createElement("img");
            img.src = m.signed_url;
            gallery.appendChild(img);
        });

    } catch (err) {
        console.error(err);
        alert("Error matching person. Check console for details.");
    }
}
</script>

</body>
</html>
